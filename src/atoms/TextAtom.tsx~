import { atom, selector } from 'recoil';

import { getCookieValue, syllableNumberState, textLengthState, containCapitalsState } from './SettingsAtoms'

// const syllableNumber: number = useRecoilValue(syllableNumberState)
// const textLength: number = useRecoilValue(textLengthState)
// const containCapitals: boolean = useRecoilValue(containCapitalsState)

const vowels = 'aeiou'.split('');
const consonants = 'bcdfghjklmnpqrstvwxyz'.split('');

export const choose = (choice: string[]): string =>
	choice[Math.floor(Math.random() * choice.length)];

const syllable = (v: string[], c: string[]): string => {
	let flag: string = choose(['0', '1', '2']);
	if (flag === '0') {
		return choose(c) + choose(v) + choose(c)
	} else if (flag === '1') {
		return choose(c) + choose(v)
	} else {
		return choose(v) + choose(c)
	}
}

const word = (v: string[], c: string[], sylNum: number): string => {
	let wordTmp: string = '';
	for (let i: number = 0; i < sylNum; i++) {
		wordTmp += syllable(v, c);
	}
	return wordTmp;
};

const textStateSelector = selector({
	key: 'textStateSelector',
	get: ({get}) => {
		const textLength = get(textLengthState)
		const syllableNumber = get(syllableNumberState)
		const containCapitals = get(containCapitalsState)

		if (containCapitals) {
			return atom({
				key: 'textState',
				default:
					[...Array(textLength)]
					.map(() => word(~document.cookie.indexOf('vwl')
						? getCookieValue('vwl').split(',')
						: vowels, 
						~document.cookie.indexOf('csn')
						? getCookieValue('csn').split(',')
						: consonants, syllableNumber))
					.map((w: string) => w.charAt(0).toUpperCase() + w.slice(1))
					.join(' ')
				})
		} else {
			return atom({
				key: 'textState',
				default:
					[...Array(textLength)]
					.map(() => word(~document.cookie.indexOf('vwl')
						? getCookieValue('vwl').split(',')
						: vowels, 
						~document.cookie.indexOf('csn')
						? getCookieValue('csn').split(',')
						: consonants, syllableNumber))
					.join(' ')
				})
		}
	}
});
